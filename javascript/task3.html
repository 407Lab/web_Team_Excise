<!DOCTYPE>
<html>
  <head>
    <meta charset="utf-8">
    <title>IFE JavaScript Task 01</title>
  </head>
<body>

  <ul id="source">
    <li>北京空气质量：<b>90</b></li>
    <li>上海空气质量：<b>70</b></li>
    <li>天津空气质量：<b>80</b></li>
    <li>广州空气质量：<b>50</b></li>
    <li>深圳空气质量：<b>40</b></li>
    <li>福州空气质量：<b>32</b></li>
    <li>成都空气质量：<b>90</b></li>
  </ul>

  <ul id="resort">
    <!-- 
    <li>第一名：北京空气质量：<b>90</b></li>
    <li>第二名：北京空气质量：<b>90</b></li>
    <li>第三名：北京空气质量：<b>90</b></li>
     -->

  </ul>

  <button id="sort-btn">排序</button>

<script type="text/javascript">

/**
 * getData方法
 * 读取id为source的列表，获取其中城市名字及城市对应的空气质量
 * 返回一个数组，格式见函数中示例
 */
function getData() {
  /*
  coding here
  */
  const data = []
  const sourceDom = document.querySelector('#source')
  // console.log(sourceDom.children)
  // for (const key in sourceDom.children) {
  //   if (sourceDom.children.hasOwnProperty(key)) {
  //     console.log(sourceDom.children[key])
  //   }
  // }
  for (const val of sourceDom.children) {
    let subArr = [val.firstChild.data, +val.firstElementChild.firstChild.data]
    data.push(subArr)
  }
  /*
  data = [
    ["北京", 90],
    ["北京", 90]
    ……
  ]
  */

  return data;

}

//  理解 为什么不用var变量 以及深入了解js的作用域、引用传递、值传递、闭包等。。
function varDemo () {
  var arr = []
  for(var i = 0; i < 10; i++) {
    // arr.push(() => {
    //     console.log('this is', i)
    // })

    // 立即执行函数 （iife）\ 闭包 \ 变量提升 \ 引用赋值 \ 函数参数值传递
    arr.push(((val) => {
      return () => {
        console.log('this is :', val)
      }
    })(i))
  }
  arr[2]()
}
varDemo()

/**
 * sortAqiData
 * 按空气质量对data进行从小到大的排序
 * 返回一个排序后的数组
 */
function sortAqiData(data) {
  let resortArr = data.sort((a, b) => {
    return a[1] - b[1]
  })
  return resortArr
}

/**
* clearrender
* 自己添加清除父节点所有子节点的函数
* 你们可以尝试使用和不使用时的区别
*/
function clearRender(dom) {
  const CHILDREN = 0
  if(dom.childElementCount > CHILDREN) {
    dom.innerHTML = ''
  }
}

/**
 * render
 * 将排好序的城市及空气质量指数，输出显示到id位resort的列表中
 * 格式见ul中的注释的部分
 */
function render(data) {
  const resortDom = document.querySelector('#resort')
  // 删除现有ul下所有子元素， 然后重新添加排序后的元素， 这样就不会出现累加子元素的现象。
  clearRender(resortDom)
  data.forEach((item, index) => {
    let bElement = document.createElement('b')  
    bElement.innerText = item[1]
    let liElement = document.createElement('li')
    liElement.innerText = item[0]
    liElement.appendChild(bElement)
    resortDom.appendChild(liElement)
  })
} 

function btnHandle() {
  var aqiData = getData();
  aqiData = sortAqiData(aqiData);
  render(aqiData);
}

function init() {

  // 在这下面给sort-btn绑定一个点击事件，点击时触发btnHandle函数
  const btn = document.querySelector('#sort-btn')
  btn.addEventListener('click', () => {
    btnHandle()
  })
}

init();

</script>
</body>
</html>